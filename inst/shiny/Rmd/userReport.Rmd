---
title: Wallace Session `r Sys.Date()`
output: html_document
---

```{r setup, include=FALSE}
library(knitr)
knit_engines$set(asis = function(options) {
  if (options$echo && options$eval) knit_child(text = options$code)
})
knitr::opts_chunk$set(message = FALSE, warning = FALSE, eval = FALSE)
```

```{r vars, include = FALSE, eval = TRUE}
# comp1
occs.db <- "{{occsSource}}" != "user"
occs.user <- "{{occsSource}}" == "user"
poccs.any <- !is.null({{occsRemoved}})
poccs.rem <- !is.null({{occsRemoved}})
```

Please find below the R code history from your *Wallace* v1.9.9* session. 

You can reproduce your session results by running this R Markdown file in RStudio. 

Each code block is called a "chunk", and you can run them either one-by-one or all at once by choosing an option in the "Run" menu at the top-right corner of the "Source" pane in RStudio. 

For more detailed information see <http://rmarkdown.rstudio.com>).

### Package installation

Wallace uses the following R packages that must be installed and loaded before starting.
```{r loadPkgs}
library(spocc)
library(spThin)
library(dismo)
library(rgeos)
library(ENMeval)
```

Wallace also includes several functions developed to help integrate different packages and some additional functionality. For this reason, it is necessary to load the file `functions.R`, The function `system.file()` finds this script, and `source()` loads it.

```{r loadFunctions}
source(system.file('shiny/funcs', 'functions.R', package = 'wallace'))
```

## Record of analysis for *`r "{{spName}}"`*.

```{asis occsTitle}
### Obtain Occurrence Data
```

```{asis, echo = occs.db, eval = occs.db, include = occs.db}
You searched the `r "{{occsSource}}"` database for *`r "{{spName}}"`*, limited to `r {{occsNum}}` records. 
```

```{r occSearch, echo = occs.db, include = occs.db}
# query selected database for occurrence records
occs <- c1_queryDb(spName = "{{spName}}", occDb = "{{occsSource}}", occNum = {{occsNum}})
```

```{asis, echo = occs.user, eval = occs.user, include = occs.user}
User CSV path with occurrence data. If the CSV file is not in the current workspace, change to the correct file path (e.g. "/Users/darwin/Documents/occs.user").
```

```{r occInput, echo = occs.user}
# NOTE: provide the path to the .csv file
occs.path <- ""
# get a list of species occurrence data
occs <- c1_userOccs(csvPath = occs.path, csvName = "{{occsCSV}}")
```


```{asis, echo = poccs.any, eval = poccs.any, include = poccs.any}
### Process Occurrence Data
```

```{asis, echo = poccs.rem, eval = poccs.rem, include = poccs.rem}
Remove the occurrence localities with the following IDs: `r {{occsRemoved}}`.
```

```{r poccs.rem, echo = poccs.rem, include = poccs.rem}
# remove the rows that match the occIDs selected
occs <- occs %>% filter(!(occID %in% {{occsRemoved}}))
```



